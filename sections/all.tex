%!TEX root = ../main.tex
%!TEX spellcheck = en-en_US

%%% Global vars
\global\long\def\wrapconops{0.53\textwidth}
\global\long\def\wrapTPMee{0.56\textwidth}
\global\long\def\wrapTPM{0.59\textwidth}
\global\long\def\posteggio{0.249\textwidth}
\global\long\def\budgetwi{0.835\textwidth}
\global\long\def\wmabudget{0.64\textwidth}
%

\section{Introduction}\label{sec:Intro}
The Earth--Moon system is constantly bombarded by meteoroids of different sizes, and their numbers are significant. By observing the lunar surface impacts, whose flux is similar to that of the Earth, detailed information could be obtained  regarding their magnitudes, velocities, temporal and spatial distributions. This information has applications in	generating high fidelity solar-system meteoroid models, validating the existing lunar impact models, contributing to lunar seismology studies and interior modeling, and initiating a \emph{Lunar Situational Awareness} program for future exploration missions. The flashes produced by the lunar meteoroid impacts are currently observed from Earth-based	resources, but they are restricted by geometry, illumination, and weather.

In the framework of the SysNova initiatives, under the theme of LUCE, the European Space Agency issued the following technology challenge to the scientific community: \emph{If you could fly a CubeSat to the Moon, what could such a tiny satellite do there?} In responding to the SysNova competition, a futuristic mission to the Moon has been proposed: the {LUMIO} mission, placed at Earth--Moon $L_2$, to observe, quantify, and characterize the meteoroid impacts by detecting the impact flashes on the lunar farside. This will complement the knowledge gathered by Earth-based observations of the lunar nearside, thus synthesizing a global information of the Lunar Meteoroid Environment. The mission utilizes a 12U form-factor CubeSat which carries the LUMIO-Cam, an optical instrument capable of detecting light flashes in the near-infrared and visible spectrum to continuously monitor and process the optical information.

In this paper, we address the challenges and solutions of designing a robust and versatile trajectory in cislunar space for an active platform with very limited resources (\eg a CubeSat) while effectively performing scientific measurements. Specifically, the LUMIO baseline operative orbit is selected based on a rigorous trade-off analysis on geometric, maintenance, and reachability constraints. Orbital geometry to aid scientific observations, station-keeping (S/K), and transfer cost are considered in the analysis. The mission utilizes a novel orbit design and latest CubeSat technologies to serve as a pioneer in demonstrating how CubeSats can become a viable new tool for innovative planetary research and deep space exploration.

The remainder is organized as follows. Section \ref{sec:Lunar situational awareness} puts forward the scientific relevance of observing meteoroids impact with the lunar surface, while in Section \ref{sec:LUMIO mission} an overview of the LUMIO mission is given. An orthodox trade-off for the selection of LUMIO operative orbit is performed in Section \ref{sec:LUMIO operative orbit}.


%
%%%%%%%%%%%%%%%%%%%%%%%%%%
%% LSA %%%%%
\section{Lunar situational awareness}\label{sec:Lunar situational awareness}
Impacts due to near-Earth objects (NEO) could cause a devastating humanitarian crisis and potentially the extinction of the human race. While the probability of such an event is low, the outcome is so catastrophic that it is imperative to invest resources to mitigate them. Telescopic surveys detect {NEO} of size greater than $1$ km down to $1$ meter, but there are few direct methods for monitoring the sub-meter meteoroid population. Serendipitous monitoring of atmospheric explosions due to airbursts of meteoroids are being undertaken. These objects are part of the roughly $33$ metric tons of debris impacting the Earth each day.

Vast amounts of meteoroids and micrometeoroids continuously enter the Earth--Moon system and consequently become a potential threat which has caused, in particular, a substantial change in the lunar surface and its {properties~\cite{oberst2012present}}. The Moon has no atmosphere to protect itself and is subjected to impacts from meteoroids ranging from a few kilograms to tens of grams each day. Recent observations from the camera on NASA's {LRO} have provided direct evidence for the devastating effect of such impacts on the lunar {surface~\cite{speyerer2016quantifying}}. Based on these observations, it is now evident that the top few centimeters of the regolith on the entire lunar surface is moved every $81,000$ years. This new finding is significant as previous models had predicted it to occur over a period of $10$ million years. The constant mixing of the regolith with exogenic material (remnant impactor material) has implications for studying the lunar surface using remote sensing techniques, such as reflectance spectroscopy that sample only the top hundred microns. The high impact rate on the lunar surface also has important implications for future human and robotic assets that will inhabit the Moon for significant periods of time, and a greater understanding of these impacts is required.

A better understanding of the lunar impact situation is essential for the design and safety of future Moon bases, robotic and human exploration of the Moon. These long-term missions will require a dedicated space-based impact-monitoring asset to address the problem of weather-dependent observation quality and also to fully understand the impact of NEO on the farside of the Moon. As the meteoroids impact the lunar surface their kinetic energy is partitioned into
%
\begin{enumerate}
	\item The excavation of a crater;
	\item The generation of seismic waves;
	\item the production of a light flash.
\end{enumerate}
%
The seismic waves propagate through the lunar interior and can be detected by seismometers emplaced in situ. The fresh craters can be detected by taking and comparing a myriad of high-resolution images of the lunar surface. Observing the light flashes is the only viable way to detect lunar meteoroid impacts remotely. Such observations reveal characteristics like energy levels and velocities of the individual meteoroids, which are crucial for understanding and describing the meteoroid population. The number, intensities and temporal/spatial distributions of these impacts are characterized in \textcite{oberst2012present}.


%
%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Overview of LUMIO %%%%%
\section{The LUMIO mission: an overview}\label{sec:LUMIO mission}
%
\begin{figure*}[t!]
	\centering
	\includegraphics[width=0.75\textwidth]{MAmissionphases.pdf}
	\caption{General mission architecture for LUMIO.}
	\label{fig:LUMIOGeneralArchitecture}
\end{figure*}
%
The {LUMIO} mission concept is proposed to address the issues mentioned above in Section \ref{sec:Lunar situational awareness}. Specifically,
%
\begin{description}
	\item[Science Question.] What are the spatial and temporal characteristics of meteoroids impacting the lunar surface?
	%
	\item[Science Goal.] Advance the understanding of how meteoroids evolve in the cislunar space by observing the flashes produced by their impacts with the lunar surface.
	\item[Science Objective.]  Characterize the flux of meteoroids impacting the lunar surface.
\end{description}
%

The Lunar Meteoroid Impact Observer mission concept is proposed to accomplish the scientific objective above. The LUMIO concept focuses on monitoring the lunar surface for meteoroid impacts. Performing this investigation with space-based assets yields a number of benefits, namely,
%
\begin{enumerate}
	\item Observations are not biased by weather, elevating the quality of the scientific product;
	\item Meteoroids impacting the lunar farside can be observed, so complementing the ground-based, lunar nearside observations;
	\item Permanent, full-disk observations could be done regardless of the day/night cycle.
\end{enumerate}
%

LUMIO is expected to be deployed into a lunar orbit by a larger Lunar Orbiter providing transportation and data relay services. The parking orbit is an ellipse with periselene altitude of $200$ km, aposelene altitude between $500$ and $15,000$ km, and inclination between $50$ and $90$ degrees over the lunar equator. The general mission architecture is shown in \Fig{fig:LUMIOGeneralArchitecture}, where a Earth--Moon $L_2$ halo is considered. The mission is divided in $6$ well defined phases,
%
\begin{enumerate}[{\emph{Phase}} 1.]
	\item Pre-launch and launch;
	\begin{enumerate}[{1-}i.]
		\item Starts $1$ year before launch and ends after launcher successfully leaves Earth atmosphere.
	\end{enumerate}
	%
	\item Parking;
	\begin{enumerate}[{2-}i.]
		\item Starts when the Lunar Orbit deploys LUMIO on the prescribed selenocentric elliptic parking orbit
		\item Ends when LUMIO performs the stable manifold injection maneuver (SMIM);
		\item Lasts $14$ days.
	\end{enumerate}
	%
	\item Transfer;
	\begin{enumerate}[{3-}i.]
		\item Starts when LUMIO completes the SMIM;
		\item Ends when LUMIO performs the halo injection maneuver (HIM);
		\item Lasts $14$ days.
	\end{enumerate}
	% 
	\item Operative;
	\begin{enumerate}[{4-}i.]
		\item Starts when LUMIO completes the HIM;
		\item Ends after one year of operations.
	\end{enumerate}
	% 
	\item Extension;
	\begin{enumerate}[{5-}i.]
		\item May start when LUMIO completes the operative phase, provided sufficient on-board resources are available to continue nominal operations;
		\item Lasts $6$ months.
	\end{enumerate}
	%
	\item End of Life;
	\begin{enumerate}[{6-}i.]
		\item Ends when the disposal maneuver is correctly performed.
	\end{enumerate}
\end{enumerate}
%


%% Operative orbit %%%%%
\section{LUMIO mission analysis}\label{sec:LUMIO operative orbit}
Three factors are accounted for the operative orbit selection trade-off of LUMIO: a) Scientific requirements and return (\eg number of detectable impact flashes); b) Cost constraints and total $\Delta v$ effort to get and stay in the final orbit (\eg transfer maneuvers and station-keeping); and c) Autonomy of operations and the ability to navigate and acquire images without relying on the Lunar Orbiter or Earth commands (\eg constrains on Moon disk visibility).

An in-depth analysis is performed for the selection of LUMIO operative orbit. It has been shown that remotely detecting flashes is the only technically and economically viable option for a CubeSat to monitor meteoroid impacts on the lunar surface \cite{Ana2018FrontiersLUMIO}. Referring to \Fig{fig:OrbitalTradeOff}, a three-layer trade-off study is performed to select the orbit LUMIO employs to perform impact flashes detection:
%
\begin{enumerate}
	\item A preliminary trade-off scans different orbit families to check coverage, lifetime, and accessibility characteristics of the orbit families in view of LUMIO science objective. The orbit families encompass frozen perturbed Keplerian orbits \cite{condoleo2017frozen} and several three-body libration point orbits (LPO), \ie halos, planar and vertical Lyapunov orbits, distant retrograde orbits, and near-rectilinear halo orbits (NRHO)}. Candidate families are the output of this first step \cite{Ana2018FrontiersLUMIO}.
	\item In a second step, the physics of the impact is modeled with the space environment, the local orbital geometry, and the payload performances and parameters. This model is validated against Neliota dataset in \textcite{Ana2018FrontiersLUMIO}. Ad-hoc simulations engage the scientific requirement of maximizing the number of observable impacts with the need to have lunar full disk visibility for autonomous optical navigation in oder to produce feasible orbit families for LUMIO operative orbit selection \cite{franzese2018NavSciTech}.
	\item Finally, a detailed trade-off quantifies and compares the station-keeping and transfer costs for each feasible orbit.
\end{enumerate}
%
%
\begin{figure}[b!]
	\centering
	\includegraphics[width=0.5\textwidth]{OrbitalTradeOff.pdf}
	\caption{Trade-off scheme for the selection of LUMIO operative orbit.}
	\label{fig:OrbitalTradeOff}
\end{figure}
%
%
\begin{table}[b!]
	\caption{Parameters of the Earth--Moon system quasi-halos.}
	\label{tab:EMquasihalo}
	\centering
	\scriptsize
	\begin{tabular}{cccc}
		\TOPlines
		ID & $C_j$ [adim] & $A_z$ [km] &  Final date [TDB] \\
		\MIDline
		$-100001$ & $3.1613263$ & $6973.94$ & $2022$ February $13$ $23$:$28$:$27.785$ \\
		$-100002$ & $3.16$ &  $8436.02$ & $2022$ February $13$ $17$:$10$:$33.925$ \\
		$-100003$ & $3.15$ & $15172.33$ & $2022$ February $10$ $14$:$18$:$56.282$ \\
		$-100004$ & $3.14$ & $19259.07$ & $2022$ February $07$ $04$:$58$:$21.979$ \\
		$-100005$ & $3.13$ & $22225.50$ & $2022$ February $03$ $11$:$53$:$55.318$ \\
		$-100006$ & $3.12$ & $24486.23$ & $2022$ January $30$ $09$:$28$:$50.399$ \\
		$-100007$ & $3.11$ & $26220.52$ & $2022$ January $25$ $19$:$35$:$37.396$ \\
		$-100008$ & $3.10$ & $27517.73$ & $2022$ January $20$ $15$:$22$:$08.872$ \\
		$-100009$ & $3.09$ & $28418.41$ & $2022$ January $14$ $16$:$48$:$53.009$ \\
		%		Halo\_Cj3p09\_LONG.bsp & $-100099$ & $3.09$ & $28418.41$ & $2026$ October $12$ $06$:$33$:$11.372$ \\
		$-100010$ & $3.08$ & $28933.50$ & $2022$ January $07$ $18$:$09$:$09.066$ \\
		$-100011$ & $3.07$ & $29041.94$ & $2021$ December $30$ $10$:$33$:$48.374$ \\
		$-100012$ & $3.06$ & $28683.38$ & $2021$ December $20$ $03$:$31$:$03.834$ \\
		$-100013$ & $3.05$ & $27725.08$ & $2021$ December $06$ $18$:$01$:$36.741$ \\
		$-100014$ & $3.04$ & $25844.92$ & $2021$ November $17$ $15$:$42$:$38.809$ \\
		\BOTTOMlines
	\end{tabular}
\end{table}
%
In this work, the focus is placed on the last step of the analysis to select a LUMIO operative orbit. LUMIO operative orbit is selected upon the criteria mentioned above. When considering also flight heritage, \eg technology readiness level (TRL), and solar eclipse occurrences, the sole feasible orbit family is the Earth--Moon $L_2$ halo family. The methodology described in \cite{deitos2017asr} is employed to find a set of quasi-periodic halo orbits (sometimes referred here as quasi-halos or quasi-halo orbits) about Earth--Moon $L_2$. Fourteen quasi-halo orbits are computed in the high-fidelity roto-pulsating restricted $n$-body problem (RPRnBP) and saved as SPICE\footnote{SPICE is NASA's Observation Geometry and Information System for Space Science Missions \cite{acton1996ancillary,acton2018look}. The toolkit is freely available through the NASA NAIF website \url{http://naif.jpl.nasa.gov/naif/}. Last downloaded on February $7$, 2018.} kernels. The initial feeds to compute the quasi-halo samples are Earth--Moon three-body halos at $14$ different Jacobi constants, ranging from $C_j = 3.04$ to $C_j = 3.1613263$. \Table{tab:EMquasihalo} shows the quasi-halos nondimensional Jacobi energies and the relevant information to use the associated SPICE kernels. All orbits are computed starting from $2020$ August $30$ $00$:$00$:$00.000$ TDB (dynamical barycentric time). Although quasi-halos, shown in \Fig{fig:EMquasihalos} in the roto-pulsating frame (RPF), are computed for a fixed initial epoch, the persistence of libration point orbits in the solar system ephemeris model allows freedom in the refinement algorithm also for mission starting at different epochs \cite{deitos2017asr}.
%
\begin{figure*}[t!]
	\centering
	\includegraphics[width=\textwidth]{EMquasihalos.pdf}
	\caption{Projection of Earth--Moon $L_2$ quasi-halos in the roto-pulsating frame.}
	\label{fig:EMquasihalos}
\end{figure*}
%

Quasi-halo orbits of \Fig{fig:EMquasihalos} are possible LUMIO operative orbits. As the orbit becomes more energetic, or as its Jacobi constant decreases, the quasi-halo exhibits a wider range of motion both in terms of Moon range and of geometrical flight envelope about the corresponding circular restricted three-body problem (CRTBP) trajectory. The latter trend is disadvantageous when a hard pointing constraint must be respected. On the other hand, the lunar distance places a constraint on the minimum field of view (FOV) for the optical instrument on board LUMIO to be able to resolve the Moon full disk at any location along the quasi-halo. Bar charts of \Fig{fig:QHranges} show the ranges from the lunar surface to the quasi-halo samples. For discrete values of the camera field of view, simple trigonometric calculations provide the minimum distance for which the optical instrument is able to resolve the full disk of the Moon. The wider the FOV, the closer LUMIO can get to the Moon still being able to see its full disk. The horizontal lines in \Fig{fig:QHranges} indicate this distance for different values of FOV.
%
\begin{figure}[h!]
	\centering
	\includegraphics[width=0.5\textwidth]{QHrange.pdf}
	\caption{Bars for quasi-halos ranges from lunar surface.}
	\label{fig:QHranges}
\end{figure}
%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% CONOPS %%%%%
\subsection{Concept of operations}\label{subsec:CONOPS}
%
\begin{figure}[b!]
	\centering
	\includegraphics[width=0.5\textwidth]{LUMIO_ConOps.pdf}
	\caption{LUMIO concept of operations.}
	\label{fig:CONOPS}
\end{figure}
%
In the {CRTBP}, the libration points are at rest with respect to a frame co-rotating with the smaller and larger primaries. Consequently, a halo orbiting the Earth--Moon $L_2$ always faces the lunar farside. On top of this, for a wide range of Jacobi energies, Earth--Moon $L_2$ halos are almost locked into a $2$:$1$ resonance, that is $2$ orbital revolutions in $1$ synodic period. The Sun completes a full revolution around the Moon in one synodic period, approximately $T_{\textrm syn} = 29.4873$ days. The synodic period is slightly larger than the lunar orbital period around Earth to account for the amount the Sun has moved along its orbit in this duration.

The quasi-resonance locking, which is also preserved in the full ephemeris quasi-halos, enables LUMIO operations to be repetitive and regular. Within the operative phase, each synodic month LUMIO moves along a) a \emph{Science orbit} (dark solid line in \Fig{fig:CONOPS}) and b) a \emph{Navigation and Engineering orbit} (light colored solid line in \Fig{fig:CONOPS}). During the Science orbit, lasting roughly $14$ days, the Moon farside has optimal illumination conditions to perform flash observations (\ie at least half lunar disk is dark). On the other hand, during the Nav\&Eng orbit the Moon farside illumination conditions are apt to optical navigation routines. LUMIO concept of operations (ConOps) is somewhat simplified and tight to both resonance mechanisms and illumination conditions to properly enable scientific or other operations.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% S/K strategy %%%%%
\subsection{Station-keeping strategy}\label{subsec:S/K strategy}
One of the main goals of the mission analysis and trajectory design process is the determination of the nominal path. In most cases, it is not strictly necessary for the spacecraft to move precisely along the nominal trajectory in order to accomplish mission objectives. Indeed, once the nominal orbit is determined, it is desired to maintain the actual flown trajectory of the spacecraft within some region (\eg torus- or box-shaped) about the reference path. Nonmodeled perturbations and errors will cause the spacecraft to drift from the nominal path, and the unstable nature of the libration point orbits will further amplify the deviation. Assuming discrete and impulsive corrections \cite{mengali2005Biimpulsive}, the  problem consists in finding the required corrective maneuvers in terms of magnitude, direction, and timing of each $\Delta v$. In optimal S/K problems, the total $\Delta v$ budget is minimized.

In light of the limited $\Delta v$ capability, fuel consumption for S/K around the operative orbits will be a critical factor for mission sustainability. Using the generated orbits as reference trajectories, a computationally efficient Monte-Carlo routine is devised for estimation of the cost of each S/K maneuver. An effort is directed toward the development of a S/K strategy that can be used to maintain CubeSats near  such nominal libration point trajectories. Specifically, the S/K cost is estimated by employing the target points method (TPM) first introduced by \citeauthor{dwivedi1975} in the case of deterministic optimal maneuver strategy for multi-target missions \cite{dwivedi1975}, then adapted to the problem of LPOs S/K by \textcite{howell1993stationkeeping}, and finally used for JAXA's EQUULEUS mission analysis \cite{kenshiro2017equuleus}. A massive Monte-Carlo simulation is performed with $10,000$ samples, considering the impact of the injection, tracking, and maneuver execution processes on the nominal orbit determined in the presence of solar radiation pressure and gravity of the main solar system celestial bodies (\ie sun, $8$ planets, the Moon, and Pluto). To precisely simulate a realistic spacecraft trajectory,
%
\begin{enumerate}
	\item The initial conditions of the quasi-halos are altered to account for orbit insertion error.
	\item Tracking windows are considered in which orbit determination (OD) campaigns modify the actual knowledge of the spacecraft state by means of optical measurements and non-linear filtering. Because of various uncertainties in the {OD} process, the spacecraft position and velocity are never exactly known. To simulate tracking errors, the six S/C states are altered at the end of each {OD} campaign.
	\item At various time along the trajectory, the S/K strategy will determine that a maneuver is required, and its magnitude and direction will be computed. To model the inaccuracy of maneuvers actual implementation, each $\Delta\vect{v}_{S/K}$ component is randomly altered.
\end{enumerate}
%
The orbit injection, $\vect{\varepsilon}_{OI}$, orbit determination, $\vect{\varepsilon}_{OD}$, and the maneuver execution, $\vect{\varepsilon}_{EX}$, errors are all modeled and generated with zero-mean Gaussian distributions, \ie $\vect{\varepsilon}_{OI}\sim\mathcal{N}(0,\sigma_{OI}^2)$, $\vect{\varepsilon}_{OD}\sim\mathcal{N}(0,\sigma_{OD}^2)$, $\vect{\varepsilon}_{EX}\sim\mathcal{N}(0,\sigma_{v}^2)$, where $\sigma_{OI}^2$, $\sigma_{OD}^2$, $\sigma_{EX}^2$ are the covariances of the orbit insertion, orbit determination, and maneuver execution uncertainties, respectively.

%
\begin{figure}[]
	\centering
	\includegraphics[width=0.5\textwidth]{TargetPointsMethodExample.pdf}
	\caption{Overview of S/K and TPM.}
	\label{fig:TargetPointsMethodExample}
\end{figure}
%
The S/K maneuvers, $\Delta\vect{v}_{S/K}$, are conducted at specific selected epochs during the mission. That is, maneuver timings are parameters of the S/K strategy, rather than variables. Referring to \Fig{fig:TargetPointsMethodExample}, every {OD} campaign is always terminated $\Delta t_c$ time units before the maneuver execution. $\Delta t_c$ is termed cut-off duration and it is necessary to compute, schedule, and prepare the  maneuver. The S/K maneuver planning is assumed to use $N_{tp}$ downstream points, \ie the target points, as reference states to compute the maneuver magnitude and direction. In \Fig{fig:TargetPointsMethodExample}, there are two target points, $N_{tp} = 2$, and one S/K maneuver per halo orbit. The algorithm for the detailed S/K cost analysis is shown in Algorithm \ref{alg:SK}.

%
\begin{algorithm}[]
	\caption{Cost estimation for of S/K along a reference quasi-halo.}\label{alg:SK}
	\begin{algorithmic}[1]
		\Function{DVSK}{$t_0$, $t_f$, $\Phi$, $\Delta t_v$, $\Delta t_c$, $\Delta t_i$, $\sigma^2_{OI}$, $\sigma^2_{OD}$, $\sigma^2_{EX}$, $Q$, $R$}
		\State $t\gets t_0$
		\State Generate six-dimensional OI error, $\vect{\varepsilon}_{OI}\sim\mathcal{N}(0,\sigma_{OI}^2)$
		\State OI: $\delta \vect{x}_{\textrm true}\gets\vect{\varepsilon}_{OI}$
		\While{$t \le t_f \And \delta \vect{x}_{\textrm true}$}
		\State $t_v\gets t+\Delta t_v$
		\State $t_c\gets t_v-\Delta t_c$
		\State $t_i\gets t+\Delta t_i$
		\State $\delta \vect{x}_{\textrm true}\gets \Phi(t,t_c)\delta \vect{x}_{\textrm true}$
		\State Generate six-dimensional OD error, $\vect{\varepsilon}_{OD}\sim\mathcal{N}(0,\sigma_{OD}^2)$
		\State OD: $\delta \vect{x}_{c}\gets\delta \vect{x}_{\textrm true}+\vect{\varepsilon}_{OD}$, where $\delta \vect{x}_{c} = [\delta \vect{r}_{c};\delta \vect{v}_{c}]$
		\State Maneuver planning: $\Delta\vect{v}_{S/K} = A\sum_{i=1}^{N_{pt}}\left(\alpha_i\delta\vect{r}_c+\beta_i\delta\vect{v}_c\right)$ \Comment{See \Eq{eq:TargetPointsMethoddv}}
		\State $\delta \vect{x}_{\textrm true}\gets \Phi(t_c,t_v)\delta \vect{x}_{c}$
		\State Generate three-dimensional maneuver execution error, $\vect{\varepsilon}_{EX}\sim\mathcal{N}(0,\sigma_{EX}^2)$
		\State $\Delta\vect{v}\gets\Delta\vect{v}+\Delta\vect{v}\circ\vect{\varepsilon}_v$ \Comment{Here, $\circ$ represents the Hadamard product}
		\State Maneuver execution: $\delta \vect{x}_{\textrm true}\gets\delta \vect{x}_{\textrm true}+[0_{3\times3};\Delta v]$
		\State $t\gets t_v$
		\EndWhile
		\EndFunction
	\end{algorithmic}
\end{algorithm}
% 

%% Target points method algorithm
\subsubsection{Target points method}\label{subsubsec:Target points Method}
The {TPM} provides optimal $\Delta\vect{v}_{S/K}$ computed as solution of a linear-quadratic regulator (LQR) problem that minimizes a weighted sum of the maneuvers cost and the position deviation from a reference trajectory at $N_{pt}$ downstream control points, \ie the target points. The cost function is
%
\begin{equation}
	J_{S/K} = \Delta\vect{v}_{S/K}^{\textrm T}Q\Delta\vect{v}_{S/K}+\sum_{i=1}^{N_{pt}}\vect{d}_i^{\textrm T}R_i\vect{d}_i,
\end{equation} 
%
where $\Delta\vect{v}_{S/K}$ is the S/K maneuver, Q the cost weight matrix, $\vect{d}_i$ the predicted position deviation from the reference trajectory at the $i$-th target point, and $R_i$ the weighing matrix of the deviation at the $i$-th target point. The position deviation is predicted by means of the state transition matrix of the reference trajectory, $\Phi$:
%
\begin{equation}
\label{eq:posdevSTM}
	\vect{d}_i = \Phi_{rr}(t_c,t_i)\delta\vect{r}_c+\Phi_{rv}(t_c,t_i)\delta\vect{v}_c+\Phi_{rv}(t_v,t_i)\Delta\vect{v}_{S/K}.
\end{equation}
%
In \Eq{eq:posdevSTM}, $\Phi_{rr}$ and $\Phi_{rv}$ are $3$-by-$3$ matrices that map deviation of position and velocity, respectively, to a position deviation at a subsequent epoch, $t_c$ is the cut-off epoch, $t_v$ is the maneuver execution epoch, and $t_i$ the epoch of the $i$-th target point. The solution of the minimization problem yields the analytic expression for the optimal S/K maneuver:
%
\begin{equation}
\label{eq:TargetPointsMethoddv}
\begin{aligned}
&\Delta\vect{v}_S/K = A\sum_{i=1}^{N_{pt}}\left(\alpha_i\delta\vect{r}_c+\beta_i\delta\vect{v}_c\right); \\
&A = -\left[\left(Q^{\textrm T}+Q\right)+\sum_{i=1}^{N_{pt}}\Phi_{rv}^{\textrm T}(t_v,t_i)\left(R_i^{\textrm T}+R_i\right)\Phi_{rv}(t_v,t_i)\right]^{-1}, \\
&\alpha_i = \Phi_{rv}^{\textrm T}(t_v,t_i)\left(R_i^{\textrm T}+R_i\right)\Phi_{rr}(t_c,t_i), \\
&\beta_i = \Phi_{rv}^{\textrm T}(t_v,t_i)\left(R_i^{\textrm T}+R_i\right)\Phi_{rv}(t_c,t_i).
\end{aligned}
\end{equation}
%

%% S/K results
\subsubsection{Station-keeping results}\label{subsubsec:S/K results}
\tr{ARRIVED HERE}\newpage
%
\begin{table}[b!]
	\centering
	\begin{tabular}{cc}
		\begin{minipage}{.5\textwidth}
			\caption{Modeled standard deviations.}
			\label{tab:SKUncertainties}
			\centering
			\begin{tabular}{ccc}
				\TOPlines
				Standard deviation & LUMIO & Units \\ 
				\MIDline
				$\sigma_{OI_x}$, $\sigma_{OI_y}$, $\sigma_{OI_z}$ & $10$, $10$, $10$ & [km] \\
				$\sigma_{OI_u}$, $\sigma_{OI_v}$, $\sigma_{OI_w}$ & $10$, $10$, $10$ & [cm/s] \\
				$\sigma_{OD_x}$, $\sigma_{OD_y}$, $\sigma_{OD_z}$ & $10$, $10$, $10$ & [km] \\
				$\sigma_{OD_u}$, $\sigma_{OD_v}$, $\sigma_{OD_w}$ & $10$, $10$, $10$ & [cm/s] \\
				$\sigma_{EX_u}$, $\sigma_{EX_v}$, $\sigma_{EX_w}$ & $2$, $2$, $2$ & [\%] \\
				\BOTTOMlines
			\end{tabular}
		\end{minipage}
		%
		\begin{minipage}{.5\textwidth}
			\caption{Parameters of S/K analysis.}
			\label{tab:SKParameters}
			\centering
			\begin{tabular}{ccc}
				\TOPlines
				Parameter & Value & Units \\
				\MIDline
				$\Delta t_c$ & $12$ & [hr] \\
				$\Delta t_1$ & $35$ & [days] \\
				$\Delta t_2$ & $42$ & [days] \\
				$Q$ & $I_{3\times3}\cdot10^{-1}$ & [-] \\
				$R_1$ & $I_{3\times3}\cdot10^{-2}$ & [-] \\
				$R_2$ & $I_{3\times3}\cdot10^{-2}$ & [-] \\
				\BOTTOMlines
			\end{tabular}
		\end{minipage}
	\end{tabular}
\end{table}
%
\Table{tab:SKUncertainties} reports the standard deviations of orbit insertion, navigation, and maneuver execution errors for the S/K analysis. The values of \Table{tab:SKUncertainties} are in well accordane with existing applications, \eg Artemis \cite{folta2014artemis}. More important, simulations have shown the standard deviations of \Table{tab:SKUncertainties} can be achieved with the autonomous optical navigation algorithm on-board LUMIO \cite{franzese2017thesis}. All parameters for the correct functioning of Algorithm \ref{alg:SK} have been fine-tuned with extensive simulation campaigns. The parameters fine-tuned values of the S/K algorithm are shown in \Table{tab:SKParameters}. The cut-off duration of $12$ hours is at the same time sufficiently short to prevent the spacecraft state knowledge from growing, and long enough to schedule maneuver execution operations on-board LUMIO. The target points are located at $35$ and $42$ days after orbit insertion and any subsequent S/K maneuvers. Such distant target points ensure approximately one month of quasi-halo tracking in case of maneuver execution failure. Finally, having the eigenspectrum of $Q$ a larger magnitude than that $R_i$ means the optimization weighs the deviation with respect to reference position more than the $\Delta\vect{v}_{S/K}$ cost.

%
\begin{table}[]
	\caption{Confidence for the $1$-year station-keeping cost.}
	\label{tab:SKconfidence}
	\centering
	\begin{tabular}{cccc}
		\TOPlines
		\multirow{2}{*}{$C_j$ [adim]} & \multicolumn{3}{c}{S/K cost [m/s]} \\
		& $1\sigma$ & $2\sigma$ & $3\sigma$ \\
		\MIDline
		$3.16132363$ & $75.5$ & $137.9$ & $196.5$ \\
		$3.16$ & $72.4$ & $131.6$ & $186.9$ \\
		$3.15$ & $53.4$ & $92.7$ & $128.4$ \\
		$3.14$ & $40.1$ & $66.4$ & $89.7$ \\
		$3.13$ & $29.2$ & $45.4$ & $59.2$ \\
		$3.12$ & $22.0$ & $31.6$ & $39.1$ \\
		$3.11$ & $17.8$ & $23.8$ & $28.5$ \\
		$3.10$ & $13.3$ & $16.9$ & $19.6$ \\
		$3.09$ & $18.3$ & $23.9$ & $28.1$ \\
		$3.08$ & $11.0$ & $13.9$ & $15.6$ \\
		$3.07$ & $8.8$ & $10.2$ & $11.2$ \\
		$3.06$ & $8.5$ & $9.9$ & $10.9$ \\
		$3.05$ & $7.6$ & $8.6$ & $9.3$ \\
		$3.04$ & $7.2$ & $7.9$ & $8.4$ \\
		\BOTTOMlines
	\end{tabular}
\end{table}
%
\Fig{fig:SK_strategy} shows the strategy employed for S/K maneuvers timing. For clarity, just $70$ days of operations are shown and the quasi-halo orbital period is assumed to be fixed and equal to $14$ days. Critical considerations are drawn regarding the latter assumption (\ie steady and repetitive operations scheme) in Section \ref{sec:granularops}. The first quasi-halo orbit is entirely dedicated to recover any {OI} errors by means of two maneuvers (after $1$ and $7$ days after OI). In the orbits after that, nominal operations occur, \ie there is a series of Nav\&Eng and Science orbits. Three S/K maneuvers are placed within the Nav\&Eng orbit: the first at the entry point, the second in the middle (\ie $7$ days after the entry), and the third at the end of the Nav\&Eng orbit. This maneuvers frequency configuration allows for pristine Science orbit operations, albeit it increases the cost when compared to a more spread and regular distribution of S/K maneuvers.
%
\begin{figure}[]
	\centering
	\includegraphics[width=\textwidth]{SK_strategy.pdf}
	\caption{Strategy for station-keeping maneuvers timing.}
	\label{fig:SK_strategy}
\end{figure}
%

%
\begin{figure}[t!]
	\centering
	\includegraphics[width=\budgetwi]{vSK.pdf}
	\caption{Yearly station-keeping cost for set of quasi-halos.}
	\label{fig:YearlySKcost}
\end{figure}
%
%
\begin{figure}[b!]
	\centering
	\hfill
	\subfloat[Probability distribution function.]{\includegraphics[width=0.49\textwidth]{SK_pdf.pdf}\label{subfig:SK_pdf}}
	\hfill
	\subfloat[Cumulative distribution function.]{\includegraphics[width=0.49\textwidth]{SK_cdf.pdf}\label{subfig:SK_cdf}}
	\hfill
	\caption[Inverse Gaussian distribution fit of station-keeping.]{Station-keeping yearly cost statistics for quasi-halo $-100009$. Data is fitted with an inverse Gaussian distribution.}
	\label{fig:Halo9distribution}
\end{figure}
%

S/K cost is computed for one year of life cycle for each of the quasi-halos in \Table{tab:EMquasihalo}. To obtain reliable S/K cost estimation results, a massive Monte-Carlo simulation of $10,000$ cases is performed with respect to each reference orbit generated. Each Monte-Carlo run employs Algorithm \ref{alg:SK} to compute S/K cost for a realization of $\vect{\varepsilon}_{OI}$, $\vect{\varepsilon}_{OD}$, and $\vect{\varepsilon}_{EX}$. \Table{tab:SKconfidence} displays the $1$-year S/K cost with $1\sigma$, $2\sigma$, and $3\sigma$ confidence. The Monte-Carlo data is fitted by means of an Inverse Gaussian distribution. \Fig{fig:YearlySKcost} shows mean values with associated standard deviations (displayed as error bars) of the $1$-year S/K cost. As expected, the S/K cost increases for smaller (\ie higher Jacobi constant) quasi-halos. This trend reflects the stability (eigenspectrum of monodromy matrix) properties of halo orbits. That is, a larger halo is generally less unstable and thus cheaper to maintain. Finally, \Fig{fig:Halo9distribution} shows the probability distribution function (\Fig{subfig:SK_pdf}) and the cumulative distribution function (\Fig{subfig:SK_cdf}) for the specific case of quasi-halo of ID $-100009$. Clearly, the Inverse Gaussian distribution well fits the raw data, results of the Monte-Carlo simulation for the yearly $\Delta\vect{v}_S/K$ cost.

%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Discrete manifold scan  %%%%%
\subsection{Transfer phase design}\label{subsec:Transfer phase design}
The transfer phase of LUMIO is done in the CRTBP. Free transport mechanisms are leveraged to reach the target halo. Specifically, intersection in the configuration space is sought between the halo stable manifolds and a selenocentric \emph{transition orbit}. Since the sought intersection occurs only in configuration space, a maneuver is necessary for orbital continuity. This maneuver places the spacecraft on the stable manifold of the target halo and is thus called {SMIM}, $\Delta\vect{v}_{\textrm SMIM}$. The Sysnova challenge provides assumptions and constraints on the system overall architecture. In particular, LUMIO shall be injected into a lunar orbit with constraints on the orbital elements shown in \Table{tab:OrbitalElementsConstraints}. For compliance with these requirements on the lunar orbiter stage, a plane change maneuver is scheduled to occur at the apocenter of the parking orbit. The maneuver rotates the parking orbit into the transition orbit. The transfer phase starts when the plane change maneuver, $\Delta\vect{v}_{\textrm pc}$, occurs, and ends after the {HIM}, $\Delta\vect{v}_{\textrm HIM}$, inserts the {S/C} into the target halo orbit. The aim of the transfer design analysis is to find the parameters of the selenocentric transition orbit and the stable manifold that lead to a minimum $\Delta\vect{v}_{\textrm SMIM}$ at the intersection. The optimization problem is stated hereafter, and it is solved with a {NLP} method.
%
\begin{table}[b]
	\caption{Orbital elements constraints.}
	\label{tab:OrbitalElementsConstraints}
	\centering
	\begin{tabular}{cccc}
		\TOPlines
		Orbital element & Unit & Minimum value & Maximum value \\
		\MIDline
		$h_p$ & [km] & \multicolumn{2}{c}{$200$} \\
		$h_a$ & [km] & $500$ & $15,000$ \\
		$i$ & [deg] & $50$ & $90$ \\
		\BOTTOMlines
	\end{tabular}
\end{table}
%

For this analysis, it is convenient to recall the methodology used to numerically compute the invariant manifolds in the CRTBP. This approach relies on finding a linear approximation of the manifold in the neighborhood of an orbit. An algorithm is implemented that scans the stable manifold space by varying the time along the originating halo, $t_{\textrm po}$, and the time along the stable manifold, $t_{\textrm sm}$. Once $t_{\textrm po}$ and $t_{\textrm sm}$ are specified, the stable manifold is completely determined \cite{topputo2016fastmanifolds}. $t_{\textrm po}$ uniquely specifies a state along the halo, $\vect{x}(t_{\textrm po})$. At $\vect{x}(t_{\textrm po})$, the invariant manifolds are locally spanned by the stable and unstable eigenvectors of $M(t_{\textrm po})$, the monodromy matrix associated to $\vect{x}(t_{\textrm po})$. That is, the STM evaluated over one period of the orbit. The initial conditions used to compute the stable manifold are $\vect{x}_{s_0} = \vect{x}(t_{\textrm po})\pm\varepsilon \vect{v}_s$, where $\vect{v}_s$ is the stable eigenvector of $M(t_{\textrm po})$ and $\varepsilon$ is a small displacement perturbing in the stable direction, whereas the $\pm$ discriminates which of the two branches of the manifold has to be generated. As for $\varepsilon$, it should be small enough to preserve the local validity of the linear approximation, but also large enough to prevent from long integration times needed to compute the manifold. Here, $\varepsilon=10^{-6}$ is used, consistently with the arguments in \textcite{gomez1993study}. $t_{\textrm sm}$ is the duration $\vect{x}_s$ is flown in backward time. The stable manifold state yields:
%
\begin{equation}
\label{eq:stablemanifoldstate}
\vect{x}_s = \vect{\varphi}(\vect{x}_{s_0},0;-t_{\textrm sm}),
\end{equation}
%
where $\vect{\varphi}$ is the flow of the CRTBP from $\vect{x}_{s_0}$ to $-t_{\textrm sm}$. An outline of the transfer design algorithm is shown in Algorithm \ref{alg:TransferDeign}.
%
\begin{algorithm}[!b]
	\caption{Transfer design.}\label{alg:TransferDeign}
%	\small
	\begin{algorithmic}[]
		\Procedure{Initialization}{}
		\State Set the CRTBP as default dynamical model
		\State Select $C_j$ of target halo orbit 
		\State Select manifold branch flying towards the Moon (\ie left branch for $L_2$ LPOs)
		\EndProcedure
		%
		\Procedure{Manifold scan for initial guess generation}{}
		\State Set bounds for the time along the target halo, $t_{\textrm po}\in\left[0,T\right]$ 
		\State Set maximum time along the stable manifold, $t^{(\textrm max)}_{\textrm sm}$
		\State Discretize $t_{\textrm po}$ by $\textrm{d}t_{\textrm po}$ to get $n_t$ discrete values
		\State Initialize vector $\vect{\tau}\in\mathbb{R}^{n_t\times3}$
		\For{$t_{\textrm po} = 0 \to T$ by $\textrm{d}t_{\textrm po}$ with index $k$}
		\State Get stable manifold state, $\vect{x}_s$, for current $t_{\textrm po}$ and $t^{(\textrm max)}_{\textrm sm}$ \Comment{See \Eq{eq:stablemanifoldstate}}
		\State Find $t_{\textrm sm}$ at which altitude, $h_p = \|\vect{r}_s(t_{\textrm sm})-\vect{r}_2\|-R_{\leftmoon}$, is closest to $200$ km
		\State Store $(t_{\textrm po},t_{\textrm sm},h_p)$ in the $k$-th row of vector $\vect{\tau}$
		\EndFor
		\EndProcedure
		%
		\Procedure{Transfer maneuver}{}
		\State Initialize vector $\vect{\Gamma}\in\mathbb{R}^{n_t\times16}$
		\Loop{ in $\vect{\tau}$ with index $j$}
		\Repeat
		\State Randomly initialize transition orbit elements in $\vect{e} = (h_a,i,\Omega,\omega,\theta)$
		\State Solve for $\Delta\vect{v}_{\textrm SMIM}$ using $\vect{e}$ and $j$-th row of $\vect{\tau}$ as first guess \Comment{\Eq{pb:minimizaionTransferDesign}}
		\Until{convergence is attained}
		\If{$i^{\textrm (opt)} \notin [50^\circ,90^\circ]$}
		\State Select nearest target inclination of parking orbit, $i_{pk}$ \Comment{see \Table{tab:OrbitalElementsConstraints}}
		\State Schedule plane rotation around apoaxis by $\Delta i = |i_{pk}-i^{\textrm (opt)}|$
		\State Compute plane rotation maneuver at apoaxis, $\Delta\vect{v}_{\textrm pc}$
		\State Compute updated $\Omega_{pk}$ and $\omega_{pk}$ of parking orbit
		\Else
		\State Set $\Delta\vect{v}_{pc} = \vect{0}$
		\State Set parking orbits elements equal to transition orbit elements
		\EndIf
		\State Store optimization results, $(\Delta\vect{v}_{\textrm SMIM},\Delta\vect{v}_{\textrm pc},\vect{y}^{(\textrm opt)},\Omega_{pk},\omega_{pk})$, in $\vect{\Gamma}$ $j$-th row
		\EndLoop
		\EndProcedure
		%
	\end{algorithmic}
\end{algorithm}
% 

\paragraph{Variables.}The {NLP} variables, collected in vector $\vect{y}$, are the Keplerian elements of the transition parking orbit and the times necessary to determine the stable manifold:
%
\begin{equation}
\vect{y} = (h_p,h_a,i,\Omega,\omega,\theta,t_{\textrm po},t_{\textrm sm}).
\end{equation}
%

\paragraph{Cost function.} A relevant parameter representing space mission cost is the total $\Delta v$ consumption:
%
\begin{equation}
J(\vect{y}) = \|\Delta\vect{v}_{\textrm SMIM}\|.
\end{equation}
%
The costs associated to $\Delta\vect{v}_{\textrm HIM}$ and $\Delta\vect{v}_{\textrm pc}$ are not included in the objective function because they depend solely on the deviation between the asymptotic motion of the stable manifold, \ie $\varepsilon$.

\paragraph{Constraints.} 
The intersection in configuration space between the transition orbit and the stable manifold of the target halo represents the most important constraint. Equality and inequality constraints are:
%
\begin{align}
&\begin{aligned}
\vect{c}_{eq} &= \begin{pmatrix}
\vect{r}_t(t_{\textrm SMIM})-\vect{r}_{\textrm sm}(t_{\textrm SMIM}) \\
h_p-200
\end{pmatrix},
\end{aligned}
&
&\begin{aligned}
\vect{c} &= \begin{pmatrix}
500-h_a \\
h_a-15,000
\end{pmatrix},
\end{aligned}
\end{align}
%
where $\vect{r}_t$ and $\vect{r}_{\textrm sm}$ are the positions along the transition orbit and the stable manifold, respectively, and $t_{\textrm SMIM}$ is the epoch of the {SMIM}.
%
\paragraph{Statement of the problem.}
	The problem of transfer design with an optimal impulsive maneuver can be formally stated as a constrained minimization:
	%
	\begin{align}\label{pb:minimizaionTransferDesign}
	\min_{\vect{y}}{J(\vect{y})}\quad s.t. \quad
	\begin{cases}
	\vect{c}_{eq} &= \vect{0}, \\
	\vect{c} &\le \vect{0}.
	\end{cases}
	\end{align}
	%
	The minimization is solved in a {NLP} sense, wiht an active-set algorithm.


%% TCMs %%%%%
\subsubsection{Results of the transfer design }\label{subsubsec:TransferDesignResults}
Algorithm \ref{alg:TransferDeign} is applied to all halos in the Jacobi energy range of \Table{tab:EMquasihalo}. \Fig{fig:TotalTransferCost} shows the total transfer cost for different halos. The cost includes S/K, SMIM, and plane change maneuvers. On the other hand, \Fig{fig:Halo9SampleStableManifold} displays four sample stable manifolds of the halo with $C_j = 3.09$ at $t_{\textrm po}=0$ (\Fig{subfig:Hc09SM_M1}), $t_{\textrm po}=T/5$ (\Fig{subfig:Hc09SM_M5}), $t_{\textrm po}=7T/10$ (\Fig{subfig:Hc09SM_M15}), and $t_{\textrm po}=9T/10$ (\Fig{subfig:Hc09SM_M19}). The selection quasi-halo ID $-100009$ as LUMIO operative orbit is made based on results summarized in \Fig{fig:TotalTransferCost}. Indeed, quasi-halo ID $-100009$ is located at the center of a minimum plateau for total transfer cost which provide both a) optimality of maneuvers cost, and b) robustness against errors in the actual energy level of the injected stable manifold.
%
\begin{figure}[b!]
	\centering
	\includegraphics[width=\textwidth]{dvBudget.pdf}
	\caption{Total transfer cost for different halos.}
	\label{fig:TotalTransferCost}
\end{figure}
%
%
\begin{figure}[]
	\centering
	\hfill
	\subfloat[$t_{\textrm po} = 0$.]{\includegraphics[width=\posteggio]{Hc09SM_M1.pdf}\label{subfig:Hc09SM_M1}}
	\hfill
	\subfloat[$t_{\textrm po} = T/5$.]{\includegraphics[width=\posteggio]{Hc09SM_M5.pdf}\label{subfig:Hc09SM_M5}}
	\hfill
	\subfloat[$t_{\textrm po} = 7T/10$.]{\includegraphics[width=\posteggio]{Hc09SM_M15.pdf}\label{subfig:Hc09SM_M15}}
	\hfill
	\subfloat[$t_{\textrm po} = 9T/10$.]{\includegraphics[width=\posteggio]{Hc09SM_M19.pdf}\label{subfig:Hc09SM_M19}}
	\hfill
	\caption[Stable manifolds of operative halo]{Samples stable manifolds of halo with $C_j = 3.09$ at different $t_{\textrm po}$.}
	\label{fig:Halo9SampleStableManifold}
\end{figure}
%

It is conjectured the reason why the transfer cost has a clearcut minimum area is twofold. 1) For high energy levels (\ie low Jacobi constant), the stable manifold configuration space does not get close enough to the Moon to permit intersection with the selenocentric transition orbit. At the other end of the spectrum, 2) for high Jacobi constant values, the stable manifolds cross the lunar region sufficiently close to provide patching opportunities with a selenocentric transition orbit, but the speed mismatch is comparatively large. \ie the outbound stable manifold is much faster than the S/C at periselene. The transfer parameters are shown in \Table{tab:TranferParameters}. As expected, the {SMIM} occurs at the pericenter of the transition orbit. Interestingly, the inclination of the transition orbit already lies within the parking orbit bounds, and no plane maneuver is necessary.
%
%\begin{wraptable}{R}{0.3\textwidth}
\begin{table}[h!]
	\caption{Main parameters for the transfer phase.}
	\label{tab:TranferParameters}
	\centering
	\begin{tabular}{ccccccc}
		\TOPlines
		Parameter & $h_p$ & $h_a$ & $a$ & $e$ & $i$ & $\Omega$ \\
		Value & $200$ & $14964.2$ & $9319.2$ & $0.7921$ & $78.1$ & $30.0$ \\ 
		Units & [km] & [km] & [km] & [-] & [deg] & [deg] \\
		\MIDline
		Parameter & $\omega$ & $\vartheta$ & $T$ & $t_{\textrm po}$ & $t_{\textrm sm}$ & \\
		Value & $301.2$ & $\approx0$ & $22.42551$ & $0.7406$ & $7.5397$ & \\
		Units & [deg] & [deg] & [hours] & [adim] & [adim] & \\
		\BOTTOMlines
	\end{tabular}
	%\end{wraptable}
\end{table}
%

%% TCMs %%%%%
\subsection[Trajectory correction maneuvers]{Trajectory correction maneuvers}\label{subsec:Monte Carlo analysis for TCMs scheduling}
A number of {TCM} is scheduled to occur during the transfer along the stable manifold. In this work, the timing and the number of {TCM} is fixed. In particular, two {TCM} are scheduled, the first one day after the {SMIM}, and the second $7$ days after $\Delta\vect{v}_{\textrm SMIM}$, or equivalently $6$ days after TCM1. A detailed study of the TCM problem for several {LPO}, just by using simple dynamical systems concepts, has shown that two {TCM} provide sufficient degrees of freedom \cite{gomez2005TCM}.

In this work, the {TCM} are found using optimal control theory \cite{serban2002haloTCM}. The total {TCM} cost, $J = \|\Delta\vect{v}_{\textrm TCM1}\|+\|\Delta\vect{v}_{\textrm TCM2}\|$, is minimized such that the state dispersion at the halo injection epoch is within $1000$ km in position and $1$ m/s in velocity. The dispersion is triggered by a bias in the stable manifold injection point, that may represent, for instance, thrust misalignment in the execution of the {SMIM} and/or orbit determination uncertainties. A Monte-Carlo simulation is run with $10,000$ random initializations of the bias error, with Gaussian distribution, after the {SMIM} is performed. During each Monte-Carlo run, an optimal problem is solved for the magnitudes and directions of $\Delta\vect{v}_{\textrm TCM1}$ and $\Delta\vect{v}_{\textrm TCM2}$.
%
\begin{figure}[t!]
	\centering
	\hfill
	\subfloat[Probability distribution function of TCM1.]{\includegraphics[width=0.248\textwidth]{TCM1_pdf.pdf}\label{subfig:TCM1_pdf}}
	\hfill
	\subfloat[Cumulative distribution function of TCM1.]{\includegraphics[width=0.248\textwidth]{TCM1_cdf.pdf}\label{subfig:TCM1_cdf}}
	\hfill
	\subfloat[Probability distribution function of TCM2.]{\includegraphics[width=0.248\textwidth]{TCM2_pdf.pdf}\label{subfig:TCM2_pdf}}
	\hfill
	\subfloat[Cumulative distribution function of TCM2.]{\includegraphics[width=0.248\textwidth]{TCM2_cdf.pdf}\label{subfig:TCM2_cdf}}
	\hfill \\
	\hfill
	\subfloat[Position condifence ellipsoid at HIM.]{\includegraphics[width=0.498\textwidth]{PositionConfidence.pdf}\label{subfig:TCMPositionConfidence}}
	\hfill
	\subfloat[Velocity condifence ellipsoid at HIM.]{\includegraphics[width=0.498\textwidth]{VelocityConfidence.pdf}\label{subfig:TCMVelocityConfidence}}
	\hfill
	\caption[Trajectory correction maneuvers.]{{TCM}.}
	\label{fig:TCMsData}
\end{figure}
%

%
\begin{wraptable}{}{0.4\textwidth}
	\vspace*{-1.1cm}
	\caption{TCMs confidence.}
	\label{tab:TCMconfidence}
	\centering
	\begin{tabular}{cccc}
		\TOPlines
		\multirow{2}{*}{TCM} & \multicolumn{3}{c}{$\|\Delta\vect{v}_{\textrm TCM}\|$ [m/s]} \\
		& $1\sigma$ & $2\sigma$ & $3\sigma$ \\
		\MIDline
		TCM1 & $28.6$ & $53.0$ & $73.1$ \\
		TCM2 & $6.5$ & $15.0$ & $24.8$ \\
		\BOTTOMlines
	\end{tabular}
\end{wraptable}
%
\Table{tab:TCMconfidence} shows the {TCM} costs with $1\sigma$, $2\sigma$, and $3\sigma$ confidence, for the transfer towards halo ID $-100009$. Monte-Carlo output data has been fit to match a Burr-type probability distribution function. The probability distribution functions of TCM1 and TCM2 are shown in \Fig{subfig:TCM1_pdf} and \Fig{subfig:TCM2_pdf}, respectively, while the cumulative distribution functions of TCM1,2 are shown in \Fig{subfig:TCM1_cdf} and \Fig{subfig:TCM2_cdf}, respectively. Clearly, the first {TCM} is predominant, while the second adjusts the trajectory for a precise targeting of the halo injection point. Finally, \Fig{subfig:TCMPositionConfidence} and \Fig{subfig:TCMVelocityConfidence} display the position and velocity ellipsoids, respectively, that ensure a $95\%$ confidence level for the {HIM} targeting. Position and velocity trajectories from the {SMIM} to the {HIM} are also shown. The main axis of inertia of the position confidence ellipsoid span $(277.2,663.7,3024.2)$ km, whilst those of the velocity confidence ellipsoid span $(0.69,0.83,2.65)$ m/s.

\section{Baseline mission} \label{sec:baseline_mission}
%----------------------------------------------------------------------------------------
\subsection{$\Delta v$ budget}
\label{subsec:deltavbudget}
%%
%\begin{wrapfigure}{L}{\wmabudget}
%	\vspace*{-0.8cm}
%	\centering
%	\includegraphics[width=\wmabudget]{WholeTraj.pdf}
%	\caption{Total transfer cost for different halos.}
%	\label{fig:WholeTraj}
%\end{wrapfigure}
%%
Mission $\Delta v$ budgets for each maneuver and phase are reported in \Table{tab:MissiondvBudgets} with both deterministic and confidence values. The total $1\sigma$-cost is $154.4$ m/s, which is also in line with a 12U CubeSat volume and mass  budgets.
%
\begin{table}[!h]
	\caption{Mission $\Delta v$ budgets.}
	\label{tab:MissiondvBudgets}
	\centering
	\begin{tabular}{ccc|cc}
		\TOPlines
		\multirow{2}{*}{Maneuver} & \multicolumn{4}{c}{Cost [m/s]} \\
		& Deterministic & $1\sigma$ & $2\sigma$ & $3\sigma$ \\
		\MIDline
		PCM               & $0$  & - & - & - \\
		Transition orbit S/K & - & $8$ & $8$ & $8$ \\
		SMIM              & $89.47$ & - & - & - \\
		TCM1              & - & $28.6$ & $53.0$ & $73.1$ \\
		TCM2              & - & $6.5$ & $15.0$ & $24.8$ \\
		HIM               & $0.5$ & - & - & - \\
		$1$-year S/K & - & $18.3$ & $23.9$ & $28.1$ \\
		Disposal          & $3$ & - & - & - \\
		\MIDline
		\textbf{TOTAL} & \multicolumn{2}{c}{\ \ $154.4$} & $192.9$ & $227.0$ \\
		\BOTTOMlines
	\end{tabular}
\end{table}
%

%----------------------------------------------------------------------------------------
\subsection{Time window for injection into parking orbit}\label{subsec:Time window for injection into parking orbit}
The time window for parking orbit insertion is selected solely based on constraints on autonomy of navigation. During the parking phase, LUMIO uses the Earth as celestial reference for optical navigation. To ensure a sufficient degree of performance of the camera and the {ekf}, at least $50\%$ of the Earth visible part shall be illuminated for more than seven consecutive days. These constraints translates into LUMIO--Earth--Sun angles, as sketched in \Fig{fig:InitialDateLUMIO}, and thus into epochs. Specifically, there are $12$ possible insertion windows during any year lasting approximately $7$ days. \Table{tab:InitialDateLUMIO} displays the injection date windows for the year $2023$.

%
\begin{minipage}{\textwidth}
	%
	\begin{minipage}[t!]{0.6\textwidth}
		\centering
		\includegraphics[width=\textwidth]{InitialDate.pdf}
		\captionof{figure}{Sketch of initial date selection.}
		\label{fig:InitialDateLUMIO}
	\end{minipage}
	%
	\hfill
	%
	\begin{minipage}[t!]{0.39\textwidth}
		\centering
		\captionof{table}{Initial dates.}
		\begin{tabular}{cc}
			\toprule
			\multicolumn{2}{c}{Year $2023$} \\
			\midrule
			January & $15$ -- $21$ \\
			February & $13$ -- $20$ \\
			March & $15$ -- $21$ \\
			April & $13$ -- $20$ \\
			May & $12$ -- $19$ \\
			June & $10$ -- $18$ \\
			July & $10$ -- $17$ \\
			August & $08$ -- $16$ \\
			September & $07$ -- $15$ \\
			October & $06$ -- $14$ \\
			November & $05$ -- $13$ \\
			December & $05$ -- $12$ \\
			\bottomrule
		\end{tabular}
		\label{tab:InitialDateLUMIO}
	\end{minipage}
	%
\end{minipage}
%



%----------------------------------------------------------------------------------------
\subsection{Granular operations}\label{subsec:granularops}
%
\begin{wrapfigure}{}{\wrapTPM}
	\vspace*{-0.3cm}
	\centering
	\includegraphics[width=\wrapTPM]{QuasiHaloPeriod.pdf}
	\caption[Operative quasi-halo period.]{Quasi-halo period. Dashed line is the period of the generating CRTBP halo.}
	\label{fig:QuasiHaloPeriod}
\end{wrapfigure}
%
The period of the refined quasi-halo does not match the constant orbital period of its {CRTBP} counterpart, neither it matches the synodic period of the Earth--Moon system with respect to the Sun. Thus, the S/C orbiting the quasi-halo is not locked in a $2$:$1$ resonance mechanism, rather it oscillates with varying amplitude around a nominal value, as shown in \Fig{fig:QuasiHaloPeriod}.

The regular and repetitive {CONOPS} outlined in Section \ref{sec:CONOPS} has been used to plan and the S/K strategy (see Section \ref{sec:S/K strategy}). In the real-life application the spacecraft would have to switch between Science and Nav\&Eng orbits based on in-flight requirements and feasibility of operations. For example, during the Science orbit the {S/C} shall observe the lunar surface with the optical payload to meet the mission scientific goals and requirements. In order to increase the {SNR} of optical measurements, observations must be made with sufficient dark condition on the Moon farside. A threshold of $50\%$ illumination is put to avoid stray light and saturation of the detector. On the other hand, one of the tasks LUMIO shall carry out during the Nav\&Eng orbit is autonomous optical orbit determination, whose performances increase with the visible illuminated percentile of lunar surface.
%
\begin{figure}[t!]
	\centering
	\includegraphics[width=0.995\textwidth]{CONOPS_Granularity.pdf}
	\caption{Granularity of ConOps.}
	\label{fig:CONOPS_Granularity}
\end{figure}
%

A geometric constraint on the illuminated portion of the Moon farside can be used to trigger operations switch between Science and Nav\&Eng orbits, compatibly with the task LUMIO has to perform. The illumination condition depends on the mission initial epoch. In \Fig{fig:CONOPS_Granularity}, three timelines are shown: 1) the top line corresponds to a regular planning of {CONOPS}, 2) the middle timeline represents the epoch-dependent {CONOPS} when the geometric constraint on illumination of lunar farside is considered, and 3) the bottom timeline is the intersection between planning and geometry {CONOPS}. Clearly, the duration of the Science orbits, according to the geometric analysis, experiences large deviations, always being lower than the assumed $14$ days. The bottom timeline is interpreted as follows: if the flight dynamics team deems that the regular and repetitive features of the S/K strategy has to be preserved, then the windows in which Science or Nav\&Eng tasks may be carried out are those highlighted in the bottom timeline of \Fig{fig:CONOPS_Granularity}.
%
\begin{figure}[t!]
	\centering
	\includegraphics[width=0.995\textwidth]{InitialDateGraph.pdf}
	\caption[Deviations from regular ConOps planning.]{Deviation of Science and Nav\&Eng orbits from regular planning {CONOPS}.}
	\label{fig:InitialDateGraph}
\end{figure}
%

Maximization of Science orbit duration leads to the selection of windows for possible mission starting dates. \Fig{fig:InitialDateGraph} shows the effective days allocated to Science and Nav\&Eng orbits. The worst deviations from the ideal scenario occurs across the spring equinox occurring on March $20$ $2023$ at $21$:$25$ GMT, that is roughly $115.5$ days after the starting date for the parametric search. As a result, out of $182$ days the best situation offers a Science of $82.2\%$ and a Nav\&Eng of $86.5\%$ over a 1-year test case for nominal operative life, with the {HIM} planned on September $6$ $2023$ and the parking orbit release window between August $8$-$16$ 2023. 


%----------------------------------------------------------------------------------------
\newpage
\subsection{Timeline}
\Table{tab:Timeline} shows a detailed timeline for the proposed LUMIO mission.
%
\begin{table}[h!]
	\caption{LUMIO timeline.}
	\label{tab:Timeline}
	\centering
	\small
	\begin{tabularx}{\textwidth}{ccccX}
		\TOPlines
		Order & Date & Time & Task & Description \\
		\MIDline
		$1$ & August $8$-$16$, $2023$ & All day & LUMIO deployment & Lunar Orbiter injects LUMIO into selenocentric parking orbit. \\
		$2$ & August $23$, $2023$ & $00$:$00$:$00$ & {SMIM} & LUMIO maneuvers into the stable manifold of the target halo, starting the transfer phase. \\
		$3$ & August $24$, $2023$ & $00$:$00$:$00$ & TCM1 & LUMIO performs the fisrt {TCM}. \\
		$4$ & August $30$, $2023$ & $00$:$00$:$00$ & TCM2 & LUMIO performs the second {TCM}. \\
		$5$ & September $6$, $2023$ & $00$:$00$:$00$ & {HIM} & The {HIM} places LUMIO in the target operative halo orbit. \\
		$6$ & September $6$, $2024$ & $00$:$00$:$00$ & {EoL} & LUMIO executes a disposal maneuver and de-commissions its systems. \\
		\BOTTOMlines
	\end{tabularx}
\end{table}
%
